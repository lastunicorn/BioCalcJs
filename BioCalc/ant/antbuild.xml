<?xml version="1.0"?>

<project name="BioCalc" default="main" basedir=".">
	<taskdef name="jscomp" classname="com.google.javascript.jscomp.ant.CompileTask" classpath="../BioControls/ExternalTools/ClosureCompiler/compiler.jar" />

	<target name="main">

		<echo message="Copying files to the compiled directory." />

		<delete includeEmptyDirs="true">
			<fileset dir="compiled" includes="**/*" />
		</delete>

		<copy todir="compiled/libraries">
			<fileset dir="sources/libraries" />
		</copy>

		<copy todir="compiled/images">
			<fileset dir="sources/images" />
		</copy>

		<copy file="sources/BioCalc.css" todir="compiled" />
		<copy file="sources/BioCalc.html" todir="compiled" />

		<copy file="changelog.txt" todir="compiled" />
		<copy file="license.txt" todir="compiled" />

		<antcall target="compile">
			<param name="file.output" value="compiled/BioCalc.js" />
		</antcall>

		<echo message="Copying compiled files from BioControls." />

		<copy todir="compiled/libraries/BiorhythmControls">
			<fileset dir="../BioControls/compiled">
				<include name="**/*" />
			</fileset>
		</copy>
	</target>

	<target name="compile">
		<echo message="Compiling the js files." />

		<jscomp compilationLevel="whitespace" prettyPrint="true" warning="verbose" debug="false" output="${file.output}">

			<sources dir="${basedir}/sources">
				<!-- The order of files is important -->
				<file name="Version.js" />
				<file name="ConfigurationManager.js" />
				<file name="DateFormatter.js" />
			</sources>

			<sources dir="${basedir}/sources/page">
				<!-- The order of files is important -->
				<file name="BioCalcPageData.js" />
				<file name="AboutDialog.js" />
				<file name="HelpDialog.js" />
				<file name="OptionsDialog.js" />
				<file name="BirthdaySection.js" />
				<file name="MainToolbar.js" />
				<file name="XDaySection.js" />
				<file name="ChartsSection.js" />
				<file name="BioCalc.js" />
			</sources>

		</jscomp>
	</target>

</project>
